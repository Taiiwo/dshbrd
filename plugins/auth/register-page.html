<dom-module id="register-page">
    <template>
            <h2>Sign Up</h2>
            <form id="signup-form" action="/api/1/register" method="POST">
              <label for="username">Username: </label>
              <input name="username" id="username" type="text">

              <label for="email">Email: </label>
              <input name="email" id="email" type="email">

              <label for="password">Password: </label>
              <input name="password" id="password" type="password">

              <paper-button raised id="signup">Submit</paper-button>
            </form>
    </div>
    </template>
</dom-module>
<script>
    Polymer({
        is: "register-page",
        attached: function() {
            var baseUrl = "";
            $('#signup').click(function(){
                site.api(
                    'register',
                    $("#signup-form").serialize(),
                    function(data) {
                        if (data.success) {
                            // set the session cookies
                            Cookies.set('session', data['session']);
                            Cookies.set('user_id', data['user_id']);
                            // set a global variable for the users details
                            window.user_data = data.user_data;
                            $(window).trigger("auth_changed");
                            // forward the user to the homepage
                            site.route('/');
                        } else {
                            err = data.errors[0]
                            if (err.error_name == "username_taken") {
                                console.log('Sorry, that username is taken.');
                            } else {
                                console.log('Unexpected error');
                            }
                        }
                    }
                );
                return false;
            });
        }
    });
</script>
