<link rel="import" href="../layout/taii-markdown.html" />
<dom-module id="post-page" attributes="id">
    <template>
        <style>
            #article {
                background-color: white;
                margin-top: 150px;
                padding-left: 30px;
                padding-right: 30px;
            }
            #banner {
                height: 66%;
                position: absolute;
                width: 100%;
                z-index: -1;
            }
            #article h2 {
              padding-top: 30px;
            }
        </style>
        <div id="banner"></div>
        <div class="container">
            <div id="article" class="card">
                <span class="flow-text" id="content"></span>
            </div>
        </div>
    </template>
</dom-module>
<script>
    Polymer({
        is: "post-page",
        attached: function() {
            var blank_sha512 =
            'cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce'+
            '47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e';
            var rtm = new RTM(
                'http://'+ document.location.hostname +':5000/component'
            );
            rtm.listen({
                collection: 'posts',
                recipientID_type: "username",
                senderID_type: "username",
                sender_pair: ["Public", blank_sha512],
                recipient_pairs: [['Public', blank_sha512]],
                recipient_senders: ['Posts'],
                where_recipient: {'_id': this.id},
                backlog: true
            });
            rtm.ws.on('data_received', function(data){
                $('#banner').css({
                    'background-image': 'url("' + data.data.image + '")'}
                );
                $('#article').prepend($('<h2/>')
                    .addClass('post-page')
                    .text(data.data.title)
                )
                $('#content').text(data.data.content);
                site.markdown('#content');
                rtm.ws.on('error', function(data){
                  console.log(data);
                });
            })
        }
    });
</script>
