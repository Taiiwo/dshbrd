<script type="text/javascript" src="/static/js/shapeshift.js"></script>

<dom-module id="dshbrd-grid">
    <template>
        <style>
          .grid {
            position: relative;
            width: 100%;
          }

          .card {
            display: block;
            position: absolute !important;
            width: 300px !important;
            height: 300px;
          }
        </style>
        <div id="dom_spy" hidden></div>
        <div id="dshbrd_grid" class="grid"></div>
    </template>
</dom-module>
<script>
  Polymer({
    is: "dshbrd-grid",
    attached: function(){
      var self = this;
      $(this.$.dshbrd_grid).shapeshift({
        selector: ".card",
        centerDragging: false,
        colWidth: 300,
        paddingX: 50,
        gutterX: 50,
        gutterY: 50
      });
      $(window).on("cards_added", function() {
        self.reloadGrid()
      })
    },
    addCard: function(cards){
      let self = this;
      $.each(cards, function(i, card){
        $(self.$.dshbrd_grid).append(
          $(card).addClass("card").addClass("dshbrd-grid")
        );
      });
    },
    reloadGrid: function() {
      // after pissing about for ~2 hrs, i'm unable to find a way to reload the
      // grid only after everything is sorted and reloading it will fix the
      // bug on chrome. TODO: replace this with something else
      var self = this;
      setTimeout(function(){
        console.log("reloading")
        $(self.$.dshbrd_grid).trigger("ss-rearrange");
      }, 200);
    }
  });
</script>
